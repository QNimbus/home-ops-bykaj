---
# yaml-language-server: $schema=https://schemas.bykaj.io/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: mailbackup-secrets
spec:
  refreshInterval: 5m
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: mailbackup-secrets
    creationPolicy: Owner
    template:
      data:
        "2025": |
          [retriever]
          type = SimpleIMAPSSLRetriever
          server = imap.fastmail.com
          mailboxes = ("Backup/2025",)
          username = {{ .FM_USERNAME }}
          password = {{ .FM_PASSWORD_MAILBACKUP }}
          [destination]
          type = Maildir
          path = /backup/2025/
          [options]
          verbose = 2
          read_all = false
          delivered_to = false
          received = false
        "2024": |
          [retriever]
          type = SimpleIMAPSSLRetriever
          server = imap.fastmail.com
          mailboxes = ("Backup/2024",)
          username = {{ .FM_USERNAME }}
          password = {{ .FM_PASSWORD_MAILBACKUP }}
          [destination]
          type = Maildir
          path = /backup/2024/
          [options]
          verbose = 2
          read_all = false
          delivered_to = false
          received = false
        "2023": |
          [retriever]
          type = SimpleIMAPSSLRetriever
          server = imap.fastmail.com
          mailboxes = ("Backup/2023",)
          username = {{ .FM_USERNAME }}
          password = {{ .FM_PASSWORD_MAILBACKUP }}
          [destination]
          type = Maildir
          path = /backup/2023/
          [options]
          verbose = 2
          read_all = false
          delivered_to = false
          received = false
        "2022": |
          [retriever]
          type = SimpleIMAPSSLRetriever
          server = imap.fastmail.com
          mailboxes = ("Backup/2022",)
          username = {{ .FM_USERNAME }}
          password = {{ .FM_PASSWORD_MAILBACKUP }}
          [destination]
          type = Maildir
          path = /backup/2022/
          [options]
          verbose = 2
          read_all = false
          delivered_to = false
          received = false
        "2021": |
          [retriever]
          type = SimpleIMAPSSLRetriever
          server = imap.fastmail.com
          mailboxes = ("Backup/2021",)
          username = {{ .FM_USERNAME }}
          password = {{ .FM_PASSWORD_MAILBACKUP }}
          [destination]
          type = Maildir
          path = /backup/2021/
          [options]
          verbose = 2
          read_all = false
          delivered_to = false
          received = false
        "2020": |
          [retriever]
          type = SimpleIMAPSSLRetriever
          server = imap.fastmail.com
          mailboxes = ("Backup/2020",)
          username = {{ .FM_USERNAME }}
          password = {{ .FM_PASSWORD_MAILBACKUP }}
          [destination]
          type = Maildir
          path = /backup/2020/
          [options]
          verbose = 2
          read_all = false
          delivered_to = false
          received = false
        "2019": |
          [retriever]
          type = SimpleIMAPSSLRetriever
          server = imap.fastmail.com
          mailboxes = ("Backup/2019",)
          username = {{ .FM_USERNAME }}
          password = {{ .FM_PASSWORD_MAILBACKUP }}
          [destination]
          type = Maildir
          path = /backup/2019/
          [options]
          verbose = 2
          read_all = false
          delivered_to = false
          received = false
        "2018": |
          [retriever]
          type = SimpleIMAPSSLRetriever
          server = imap.fastmail.com
          mailboxes = ("Backup/2018",)
          username = {{ .FM_USERNAME }}
          password = {{ .FM_PASSWORD_MAILBACKUP }}
          [destination]
          type = Maildir
          path = /backup/2018/
          [options]
          verbose = 2
          read_all = false
          delivered_to = false
          received = false
        "2017": |
          [retriever]
          type = SimpleIMAPSSLRetriever
          server = imap.fastmail.com
          mailboxes = ("Backup/2017",)
          username = {{ .FM_USERNAME }}
          password = {{ .FM_PASSWORD_MAILBACKUP }}
          [destination]
          type = Maildir
          path = /backup/2017/
          [options]
          verbose = 2
          read_all = false
          delivered_to = false
          received = false
        "2016": |
          [retriever]
          type = SimpleIMAPSSLRetriever
          server = imap.fastmail.com
          mailboxes = ("Backup/2016",)
          username = {{ .FM_USERNAME }}
          password = {{ .FM_PASSWORD_MAILBACKUP }}
          [destination]
          type = Maildir
          path = /backup/2016/
          [options]
          verbose = 2
          read_all = false
          delivered_to = false
          received = false
        "2015": |
          [retriever]
          type = SimpleIMAPSSLRetriever
          server = imap.fastmail.com
          mailboxes = ("Backup/2015",)
          username = {{ .FM_USERNAME }}
          password = {{ .FM_PASSWORD_MAILBACKUP }}
          [destination]
          type = Maildir
          path = /backup/2015/
          [options]
          verbose = 2
          read_all = false
          delivered_to = false
          received = false
        "2014": |
          [retriever]
          type = SimpleIMAPSSLRetriever
          server = imap.fastmail.com
          mailboxes = ("Backup/2014",)
          username = {{ .FM_USERNAME }}
          password = {{ .FM_PASSWORD_MAILBACKUP }}
          [destination]
          type = Maildir
          path = /backup/2014/
          [options]
          verbose = 2
          read_all = false
          delivered_to = false
          received = false
        "2013": |
          [retriever]
          type = SimpleIMAPSSLRetriever
          server = imap.fastmail.com
          mailboxes = ("Backup/2013",)
          username = {{ .FM_USERNAME }}
          password = {{ .FM_PASSWORD_MAILBACKUP }}
          [destination]
          type = Maildir
          path = /backup/2013/
          [options]
          verbose = 2
          read_all = false
          delivered_to = false
          received = false
        "2012": |
          [retriever]
          type = SimpleIMAPSSLRetriever
          server = imap.fastmail.com
          mailboxes = ("Backup/2012",)
          username = {{ .FM_USERNAME }}
          password = {{ .FM_PASSWORD_MAILBACKUP }}
          [destination]
          type = Maildir
          path = /backup/2012/
          [options]
          verbose = 2
          read_all = false
          delivered_to = false
          received = false
        "2011": |
          [retriever]
          type = SimpleIMAPSSLRetriever
          server = imap.fastmail.com
          mailboxes = ("Backup/2011",)
          username = {{ .FM_USERNAME }}
          password = {{ .FM_PASSWORD_MAILBACKUP }}
          [destination]
          type = Maildir
          path = /backup/2011/
          [options]
          verbose = 2
          read_all = false
          delivered_to = false
          received = false
        "2010": |
          [retriever]
          type = SimpleIMAPSSLRetriever
          server = imap.fastmail.com
          mailboxes = ("Backup/2010",)
          username = {{ .FM_USERNAME }}
          password = {{ .FM_PASSWORD_MAILBACKUP }}
          [destination]
          type = Maildir
          path = /backup/2010/
          [options]
          verbose = 2
          read_all = false
          delivered_to = false
          received = false
        "2009": |
          [retriever]
          type = SimpleIMAPSSLRetriever
          server = imap.fastmail.com
          mailboxes = ("Backup/2009",)
          username = {{ .FM_USERNAME }}
          password = {{ .FM_PASSWORD_MAILBACKUP }}
          [destination]
          type = Maildir
          path = /backup/2009/
          [options]
          verbose = 2
          read_all = false
          delivered_to = false
          received = false
  dataFrom:
    - extract:
        key: fastmail
      rewrite: [{regexp: {source: (.*), target: FM_$1}}]